# This is a Makefile for ntping. If it has the name "Makefile.in"
# then it is a template for a Makefile;  to generate the actual Makefile,
# run "./configure", which is a configuration script generated by the
# "autoconf" program (constructs like "@foo@" will get replaced in the
# actual Makefile.

#----------------------------------------------------------------
# Things you can change to personalize the Makefile for your own
# site (you can make these changes in either Makefile.in or
# Makefile, but changes to Makefile will get lost if you re-run
# the configuration script).
#----------------------------------------------------------------

# Default top-level directories in which to install architecture-
# specific files (exec_prefix) and machine-independent files such
# as scripts (prefix).  The values specified here may be overridden
# at configure-time with the --exec-prefix and --prefix options
# to the "configure" script.

prefix =	@prefix@
exec_prefix =	@exec_prefix@

# Directory in which to install the program ntping:
BIN_DIR =	$(exec_prefix)/bin

# Top-level directory for manual entries:
MAN_DIR =	$(prefix)/man

# Directory in which to install manual entry for ntping:
MAN8_DIR =	$(MAN_DIR)/man8

# To change the compiler switches, for example to change from -O
# to -g, change the following line:
CFLAGS = -O

# Libraries to use when linking.
LIBS = @LIBS@ @DBMALLOC_LIB@ # -lresolv

# Some versions of make, like SGI's, use the following variable to
# determine which shell to use for executing commands:
SHELL =		/bin/sh

INSTALL =               @INSTALL@
INSTALL_PROGRAM =       @INSTALL_PROGRAM@

#----------------------------------------------------------------
# The information below is modified by the configure script when
# Makefile is generated from Makefile.in.  You shouldn't normally
# modify any of this stuff by hand.
#----------------------------------------------------------------

SRC_DIR =		@srcdir@
VPATH =			@srcdir@

#----------------------------------------------------------------
# The information below should be usable as is.  The configure
# script won't modify it and you shouldn't need to modify it
# either.
#----------------------------------------------------------------

CC =		@CC@
LD =		@CC@
CC_SWITCHES =	${CFLAGS} -I. -I.. @DEFS@

SRCS = pyntping.c straps.c slogsink.c daemonize.c
EXTR = README pyntping.8 Makefile.in configure configure.in \
	Makefile.handmade pyntping.c

.c.o:
	$(CC) -c $(CC_SWITCHES) $<

all:	pyntping straps slogsink daemonize

pyntping:	pyntping.o
	-if [ -f pyntping ] ; then mv -f pyntping pyntping.bak ; else true ; fi
	rm -f pyntping.bak || true
	$(LD) -o pyntping pyntping.o $(LIBS)

straps: straps.o
	$(LD) -o straps straps.o $(LIBS)

slogsink: slogsink.o
	$(LD) -o slogsink slogsink.o $(LIBS)

daemonize: daemonize.o
	$(LD) -o daemonize daemonize.o $(LIBS)
	
	
dynamic:

clean:
	@rm -f *.o core *~ \#*\# *.bak gmon.out pyntping straps slogsink daemonize .emacs_* lmake.???

distclean clobber realclean: clean
	@rm -f Makefile config.status config.h config.log config.cache

V=1.0
dist tar:
	rm -rf pyntping-$V pyntping-$V.tar*
	mkdir pyntping-$V
	-cp -p $(SRCS) $(EXTR) pyntping-$V
	-tar cvf ntping-$V.tar pyntping-$V
	gzip -f -v -9 pyntping-$V.tar
	rm -rf pyntping-$V

install: pyntping straps slogsink daemonize
	-if [ ! -d $(BIN_DIR) ] ; then mkdir -p $(BIN_DIR) ; else true ; fi
	rm -f $(BIN_DIR)/pyntping || true
	rm -f $(BIN_DIR)/straps || true
	rm -f $(BIN_DIR)/slogsink || true
	rm -f $(MAN8_DIR)/pyntping.8 || true
	rm -f $(MAN8_DIR)/straps.8 || true
	mkdir -p $(MAN8_DIR)
	cp $(SRC_DIR)/pyntping.8 $(MAN8_DIR)/pyntping.8
	cp $(SRC_DIR)/straps.8 $(MAN8_DIR)/straps.8
	-chmod g+w $(MAN8_DIR)/pyntping.8
	$(INSTALL_PROGRAM) -m 755 daemonize $(BIN_DIR)/daemonize
	sudo $(MAKE) sinstall

# super-user step
sinstall:
	for i in pyntping straps slogsink; \
            do \
            $(INSTALL_PROGRAM) -o root -m 4755 $$i $(BIN_DIR)/$$i; \
            done

depend:

check:
	echo '-size 120 localhost' | ./pyntping -b
	echo '-size 60 -delay 30 -mask localhost' | ./pyntping -b
	echo '-retries 2 -timeout 1 -ttl 1 localhost' | ./pyntping -b
	echo '-size 100 -delay 10 -trace 1 localhost' | ./pyntping -b
	echo '-tstamp localhost' | ./pyntping -b

